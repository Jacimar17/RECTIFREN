<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>RECTIFREN | Inventario</title>
  <link rel="stylesheet" href="css/styles.css?v=20260203_7">
</head>

<body>
  <div class="container">
    <div class="card">
      <header>
        <img src="assets/logo_rectifren.png" alt="RECTIFREN" />
        <div>
          <h1>Inventario RECTIFREN</h1>
          <div class="muted">Visualización pública del stock</div>
        </div>
      </header>

      <div class="toolbar" id="toolbar">
        <div class="search">
          <input id="search" placeholder="Buscar por CODIGO o MARCA..." />
          <button id="refresh">Actualizar</button>
        </div>

        <button id="btnLogout" title="Cerrar sesión de administrador">Cerrar sesión</button>
        <button id="btnAdmin" class="primary">Administrador</button>
      </div>

      <div class="filters">
        <button class="chip active" id="fAll" type="button">Todos</button>
        <button class="chip" id="fOut" type="button">Faltantes</button>
        <button class="chip" id="fLow" type="button">Bajo stock</button>
      </div>

      <div class="tableWrap">
        <table id="stockTable">
          <thead>
            <tr>
              <th class="col-codigo">CODIGO</th>
              <th class="col-marca">MARCA</th>
              <th class="col-stock">STOCK</th>
            </tr>
          </thead>
          <tbody id="tbody"></tbody>
        </table>
      </div>

      <div id="movPanel" style="display:none; margin-top:14px;">
        <div class="movHeader">
          <strong>Últimos movimientos</strong>
          <select id="movRange" class="select">
            <option value="week">7 días</option>
            <option value="month">30 días</option>
          </select>
          <span id="movStatus" class="muted"></span>
        </div>

        <div class="tableWrap">
          <table>
            <thead>
              <tr>
                <th>Fecha</th>
                <th>Acción</th>
                <th>CODIGO</th>
                <th>MARCA</th>
                <th>Cant.</th>
                <th>Antes</th>
                <th>Después</th>
                <th>Nota</th>
              </tr>
            </thead>
            <tbody id="movTbody"></tbody>
          </table>
        </div>
      </div>

      <p id="status" class="muted"></p>
    </div>
  </div>

  <!-- Modal Login -->
  <div id="modalOverlay" class="modalOverlay" aria-hidden="true">
    <div class="modal" role="dialog" aria-modal="true" aria-labelledby="modalTitle">
      <div class="modalHeader">
        <h2 id="modalTitle" class="modalTitle">Acceso Administrador</h2>
        <button id="btnCloseModal" class="modalClose" title="Cerrar">✕</button>
      </div>

      <div class="modalBody">
        <input id="adminUser" placeholder="Usuario" autocomplete="username" />
        <input id="adminPass" type="password" placeholder="Contraseña" autocomplete="current-password" />

        <div class="hint">
          Si el login es correcto, se habilitan: <strong>+</strong> / <strong>−</strong> / <strong>✏️</strong>, guardado automático y últimos movimientos.
        </div>

        <div class="modalActions">
          <button id="btnCancel">Cancelar</button>
          <button id="btnLogin" class="primary">Ingresar</button>
        </div>

        <p id="loginStatus" class="muted"></p>
      </div>
    </div>
  </div>

  <!-- ✅ Modal Editar stock (nuevo, estilo login) -->
  <div id="editOverlay" class="modalOverlay" aria-hidden="true">
    <div class="modal modalWide" role="dialog" aria-modal="true" aria-labelledby="editTitle">
      <div class="modalHeader">
        <h2 id="editTitle" class="modalTitle">Editar stock</h2>
        <button id="btnCloseEdit" class="modalClose" title="Cerrar">✕</button>
      </div>

      <div class="modalBody">
        <div class="editInfo">
          <div><span class="muted">Código</span><div id="editCodigo" class="editValue">-</div></div>
          <div><span class="muted">Marca</span><div id="editMarca" class="editValue">-</div></div>
          <div><span class="muted">Stock actual</span><div id="editActual" class="editValue">-</div></div>
        </div>

        <label class="muted" for="editNuevo">Nuevo stock</label>
        <input id="editNuevo" type="number" min="0" step="1" placeholder="Ingrese el nuevo stock" />

        <div class="hint">
          Se guardará el nuevo stock y se registrará el movimiento como <strong>AJUSTE</strong>.
        </div>

        <div class="modalActions">
          <button id="btnCancelEdit">Cancelar</button>
          <button id="btnSaveEdit" class="primary">Guardar</button>
        </div>

        <p id="editStatus" class="muted"></p>
      </div>
    </div>
  </div>

  <!-- Overlay de carga -->
  <div id="busyOverlay" class="busyOverlay" aria-hidden="true">
    <div class="busyCard">
      <div class="spinner" aria-hidden="true"></div>
      <div>
        <div class="busyText" id="busyText">Aplicando cambio…</div>
        <div class="busySub">Por favor espere (esto evita doble click)</div>
      </div>
    </div>
  </div>

  <script type="module" src="js/main.js?v=20260203_7"></script>
</body>
</html>
